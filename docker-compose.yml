services:
  waha:
    build:
      context: .
      dockerfile: Dockerfile.backend
    container_name: whappi-backend
    restart: always
    ports:
      - "3010:3000"
    environment:
      - NODE_ENV=production
      - PORT=3000
      - DATABASE_PATH=/app/data/whatsapp.db
      - SESSION_SECRET=${SESSION_SECRET}
      - TOKEN_ENCRYPTION_KEY=${TOKEN_ENCRYPTION_KEY}
      - CLERK_SECRET_KEY=${CLERK_SECRET_KEY}
      - CLERK_WEBHOOK_SECRET=${CLERK_WEBHOOK_SECRET}
      - FRONTEND_URL=${FRONTEND_URL}
      - ADMIN_DASHBOARD_PASSWORD=${ADMIN_DASHBOARD_PASSWORD}
    volumes:
      - whappi-data:/app/data
      - whappi-sessions:/app/sessions
      - whappi-auth:/app/auth_info_baileys
      - whappi-media:/app/media
    networks:
      - dokploy-network

  whappi-frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      args:
        - NEXT_PUBLIC_API_URL=${NEXT_PUBLIC_API_URL}
        - NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=${NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY}
        - NEXT_PUBLIC_CLERK_SIGN_IN_URL=/login
        - NEXT_PUBLIC_CLERK_SIGN_UP_URL=/register
    container_name: whappi-frontend
    restart: always
    ports:
      - "3011:3001"
    environment:
      - NODE_ENV=production
      - PORT=3001
      - NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=${NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY}
      - CLERK_SECRET_KEY=${CLERK_SECRET_KEY}
      - NEXT_PUBLIC_CLERK_SIGN_IN_URL=/login
      - NEXT_PUBLIC_CLERK_SIGN_UP_URL=/register
    networks:
      - dokploy-network

volumes:
  whappi-data:
  whappi-sessions:
  whappi-auth:
  whappi-media:


networks:
  dokploy-network:
    external: true
